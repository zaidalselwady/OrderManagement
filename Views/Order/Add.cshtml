@{
    ViewData["Title"] = "Add New Order";
}

<!-- External Resources -->
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

<div class="page-wrapper">
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content full-width">
            <h2 class="header-title animate__animated animate__fadeIn">Add New Order</h2>
            <nav class="header-nav">
                <a href="@Url.Action("Index", "Home")" class="nav-link animate__animated animate__fadeIn">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
                <button id="theme-toggle" class="theme-toggle animate__animated animate__fadeIn" aria-label="Toggle theme">🌙</button>
            </nav>
        </div>
    </header>

    <div class="container full-width">
        <div class="text-center">
            <h1 class="display-4 animate__animated animate__fadeIn" style="animation-delay: 0.3s">Create Order</h1>
        </div>

        <!-- Order Form -->
        <form id="orderForm" class="animate__animated animate__fadeIn" style="animation-delay: 0.4s">
            <!-- Order Master Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle"></i> Order Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label for="orderNumber" class="form-label">Order Number</label>
                            <input type="text" class="form-control" id="orderNumber" readonly>
                            <div class="form-text">Auto-generated upon saving</div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="orderDate" class="form-label">Order Date *</label>
                            <input type="date" class="form-control" id="orderDate" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="receivedDate" class="form-label">Received Date</label>
                            <input type="date" class="form-control" id="receivedDate">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="totalAmount" class="form-label">Total Amount</label>
                            <input type="number" class="form-control" id="totalAmount" step="0.01" readonly>
                            <div class="form-text">Calculated automatically</div>
                        </div>
                    </div>

                    <!-- Customer Selection -->
                    <div class="row">
                        <div class="col-md-9 mb-3">
                            <label for="customerId" class="form-label">Customer *</label>
                            <select class="form-control" id="customerId" required>
                                <option value="" disabled selected>Select a Customer</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3 d-flex align-items-end">
                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#customerModal">
                                <i class="fas fa-plus"></i> Add Customer
                            </button>
                        </div>
                    </div>

                    <!-- Terms and Notes -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="deliveryTerms" class="form-label">Delivery Terms</label>
                            <textarea class="form-control" id="deliveryTerms" rows="3"></textarea>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="paymentTerms" class="form-label">Payment Terms</label>
                            <textarea class="form-control" id="paymentTerms" rows="3"></textarea>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Details -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5><i class="fas fa-list"></i> Order Details</h5>
                    <button type="button" class="btn btn-success btn-sm" onclick="addOrderDetailRow()">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="orderDetailsTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Bar Code</th>
                                    <th>Item</th>
                                    <th>Description</th>
                                    <th>Unit</th>
                                    <th>Qty</th>
                                    <th>Bonus</th>
                                    <th>Price</th>
                                    <th>Discount %</th>
                                    <th>Notes</th>
                                    <th>Total</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="orderDetailsBody">
                                <!-- Order detail rows will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex justify-content-end gap-2 mb-4">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='@Url.Action("Index", "Home")'">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-info" onclick="previewOrder()">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button type="button" class="btn btn-success" onclick="resetForm()">
                    <i class="fas fa-refresh"></i> Reset
                </button>
                <button type="submit" class="btn btn-primary" id="saveOrderBtn">
                    <i class="fas fa-save"></i> Save Order
                </button>
            </div>
        </form>

        <!-- Loading Spinner -->
        <div id="loading-spinner" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer full-width animate__animated animate__fadeIn" style="animation-delay: 0.5s">
        <div class="footer-content full-width">
            <p>© 2025 - Order Management System - <a href="#">Privacy Policy</a></p>
        </div>
    </footer>

    <!-- Add Customer Modal -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerNameEnglish" class="form-label">English Name *</label>
                                <input type="text" class="form-control" id="customerNameEnglish" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerNameArabic" class="form-label">Arabic Name</label>
                                <input type="text" class="form-control" id="customerNameArabic">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerNumber" class="form-label">Customer Number</label>
                                <input type="text" class="form-control" id="customerNumber">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="customerEmail">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerPhone1" class="form-label">Phone 1</label>
                                <input type="tel" class="form-control" id="customerPhone1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerPhone2" class="form-label">Phone 2</label>
                                <input type="tel" class="form-control" id="customerPhone2">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="customerAddress" class="form-label">Address</label>
                            <textarea class="form-control" id="customerAddress" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerDiscountPercent" class="form-label">Discount %</label>
                                <input type="number" class="form-control" id="customerDiscountPercent" min="0" max="100" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerContactPerson" class="form-label">Contact Person</label>
                                <input type="text" class="form-control" id="customerContactPerson">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Preview Modal -->
    <div class="modal fade" id="orderPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Order Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="orderPreviewBody">
                    <!-- Order preview will be generated here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-info" onclick="exportToPDF()">Export PDF</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
        <script src="~/js/order-management.js"></script>
        <script src="~/js/shared.js"></script>
}

@section Styles {
        <link rel="stylesheet" href="~/css/order-management.css" />
        <link rel="stylesheet" href="~/css/shared.css" />
}